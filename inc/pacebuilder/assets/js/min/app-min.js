var ptPbApp=ptPbApp||{};!function($,t){"use strict";t.cache={$container:$("#pt-pb-main-container"),$pageTemplate:$("#page_template"),$hiddenEditor:$("#pt-pb-editor-hidden"),editorHtml:"",sectionNum:0,$html:$("html, body")},t.AddSection=function(e,o){var i=new t.Models.Section(e||{}),n=new t.Views.Section({model:i}).render().el;return t.Sections.add(i),t.addAndAnimate($(n),t.cache.$container,o),i},t.addAndAnimate=function(e,o,i,n,r){n=n||100,r&&!i?e.insertAfter(o):r?t.scrollTo(e.hide().insertAfter(o).slideDown().offset().top-n):i?t.scrollTo(e.hide().appendTo(o).slideDown().offset().top-n):o.append(e)},t.isVisualEditor=function(){return $("#wp-pt_pb_editor-wrap").hasClass("tmce-active")},t.getContent=function(){return t.isVisualEditor()?tinyMCE.get("pt_pb_editor").getContent():$("#pt_pb_editor").val()},t.setContent=function(e){t.isVisualEditor()&&void 0!==tinyMCE.get("pt_pb_editor")?tinyMCE.get("pt_pb_editor").setContent(e):$("#pt_pb_editor").val(e)},t.createEditor=function(e){e&&0!==e.length&&(e.after(t.cache.editorHtml),setTimeout(function(){"undefined"!=typeof window.switchEditors&&window.switchEditors.go("pt_pb_editor",t.getEditorMode()),window.wpActiveEditor="pt_pb_editor",t.setContent(e.val())},100))},t.removeEditor=function(){if("undefined"!=typeof window.tinyMCE){try{window.tinyMCE.execCommand("mceRemoveEditor",!1,"pt_pb_editor")}catch(t){}"undefined"!=typeof window.tinyMCE.get("pt_pb_editor")&&(window.tinyMCE.remove("#pt_pb_editor"),$("#wp-pt_pb_editor-wrap").remove())}},t.getEditorMode=function(){var t="tinymce";return"html"===getUserSetting("editor")&&(t="html"),t},t.toggleTemplate=function(t){t.preventDefault();var e=$(t.target).val();"page-builder.php"===e?($("#postdivrich, #postimagediv").hide(),$("#pt-pb-layout").show()):($("#pt-pb-layout").hide(),$("#postdivrich, #postimagediv").show())},t.scrollTo=function(e){t.cache.$html.stop().animate({scrollTop:e},600)},t.isMetaSliderActive=function(){return ptPbAppSliders&&ptPbAppSliders.meta&&1==ptPbAppSliders.meta.exists},t.Upload={},t.Upload.AddFile=function(t){var e,o=$(t.target),i=o.parent();return t.preventDefault(),e?void e.open():(e=wp.media({title:o.data("choose"),button:{text:o.data("update"),close:!1}}),e.on("select",function(){var t=e.state().get("selection").first();e.close(),i.find(".pt-pb-upload-field").val(t.attributes.url),i.find(".pt-pb-upload-field-id").val(t.attributes.id),"image"==t.attributes.type&&i.find(".screenshot").empty().hide().append('<img src="'+t.attributes.url+'">').slideDown("fast"),i.find(".pt-pb-upload-button").hide(),i.find(".pt-pb-remove-upload-button").show()}),void e.open())},t.Upload.RemoveFile=function(t){t.find(".pt-pb-upload-field").val(""),t.find(".screenshot").slideUp(200,function(){$(this).empty()}),t.find(".pt-pb-remove-upload-button").hide(),t.find(".pt-pb-upload-button").show()},t.tour=null,t.validTour=!0,t.startPBTour=function(){if(t.Sections&&t.Sections.length>0){var e=$("#pt-pb-tour li:first-child");e.find(".content").html($("#tour-pb-not-empty").html()),e.find(".buttons a").hide(),e.find(".buttons .endtour").show(),t.validTour=!1}if(t.pbTourStarted=!0,null!==t.tour)return void t.tour.trigger("depart.tourbus");var o=$("#pt-pb-tour").tourbus({autoDepart:!0,onLegStart:function(e,i){if(e.rawData.autoProgress){var n=e.index;setTimeout(function(){i.currentLegIndex==n&&i.next()},e.rawData.autoProgress)}return e.rawData.highlight&&(e.$target.addClass("intro-tour-highlight"),e.$target.is("a")?e.$target.on("click",function(){t.pbTourStarted&&setTimeout(function(){o.trigger("next.tourbus")},700)}):e.$target.is("select")?e.$target.on("change",function(){function t(){e.length>0?o.trigger("next.tourbus"):setTimeout(t,200)}var e=$("#pt-pb-layout:visible");setTimeout(t,200)}):e.$target.hasClass("pt-pb-column")&&e.$target.find(".pt-pb-insert-module").on("click",function(){t.pbTourStarted&&setTimeout(function(){o.trigger("next.tourbus")},700)}),$(".intro-tour-overlay").show()),0===e.index?(e.$el.css({visibility:"visible",opacity:0,top:e.options.top/2}).animate({top:e.options.top,opacity:1},500,function(){e.show()}),!1):void 0},onLegEnd:function(t){t.rawData.highlight&&(t.$target.removeClass("intro-tour-highlight"),$(".intro-tour-overlay").hide())}}).on("stop.tourbus",function(){t.pbTourStarted=!1});t.tour=o,t.validTour&&(t.cache.$pageTemplate.val("default").trigger("change"),$("body").on("click",".tour-close-reveal",function(){t.pbTourStarted&&$(".reveal-modal:visible").trigger("reveal:close")}).on("click",".tour-select-layout",function(){function t(){e.length>0?o.trigger("next.tourbus"):setTimeout(t,200)}$(".column-layouts li:nth-child(3)").trigger("click");var e=$(".pt-pb-section:first-child .pt-pb-row:first-child");setTimeout(t,200)}).on("click",".tour-select-module",function(){function t(){e.length>0?o.trigger("next.tourbus"):setTimeout(t,200)}$(".column-module:first-child").trigger("click");var e=$(".pt-pb-image-edit");setTimeout(t,200)}).on("click",".tour-close-module",function(){function t(){e.length>0?($(".reveal-modal:visible").trigger("reveal:close"),o.trigger("next.tourbus")):setTimeout(t,200)}var e=$(".pt-pb-section:first-child .pt-pb-row:first-child  .pt-pb-column:first-child");setTimeout(t,200)}).on("click",".tourbus-end",function(){o.trigger("stop.tourbus")}))},t.Sections=new t.Collections.Section}(jQuery,ptPbApp),jQuery(document).ready(function($){ptPbApp.cache.editorHtml=ptPbApp.cache.$hiddenEditor.html(),ptPbApp.cache.$hiddenEditor.remove(),ptPbApp.cache.$pageTemplate.on("change",ptPbApp.toggleTemplate).trigger("change"),ptPbApp.cache.$container.sortable({handle:".pt-pb-header",forcePlaceholderSizeType:!0,distance:2,tolerance:"pointer",items:".pt-pb-section",cancel:".pt-pb-settings, .pt-pb-clone, .pt-pb-remove, .pt-pb-section-add, .pt-pb-row-add, .pt-pb-insert-module, .pt-pb-insert-column, .pt-pb-content",update:function(){var t=[];$(this).find(".pt-pb-section").each(function(){t.push($(this).attr("id"))}),ptPbApp.Sections.models=_(ptPbApp.Sections.models).sortBy(function(e){return _.indexOf(t,e.id)})}}),ptPbApp.cache.$container.on("click",".pt-pb-module-toggle",function(t){t.preventDefault(),$(this).closest(".module-controls").siblings(".content-preview, .slide-content-preview").slideToggle(300,function(){$(this).siblings(".module-controls").toggleClass("close")})});var t=$('<div id="start-pt-pb-tour" class="screen-meta-toggle"><a href="#">Page Builder Tour</a></div>').click(function(t){t.preventDefault(),ptPbApp.startPBTour()});$("#screen-meta-links").append(t),$(".pt-pb-insert-section").on("click",function(t){t.preventDefault(),ptPbApp.AddSection(null,!0)}),_.each(ptPbAppSections,function(t){ptPbApp.AddSection(t)}),$("#pt_pb_loader").slideUp()});