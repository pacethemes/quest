var ptPbApp=ptPbApp||{};!function($,t){"use strict";t.cache={$container:$("#pt-pb-main-container"),$pageTemplate:$("#page_template"),$hiddenEditor:$("#pt-pb-editor-hidden"),editorHtml:"",sectionNum:0,$html:$("html, body")},t.AddSection=function(e,i){var o=new t.Models.Section(e||{}),n=new t.Views.Section({model:o}).render().el;return t.Sections.add(o),t.addAndAnimate($(n),t.cache.$container,i),o},t.addAndAnimate=function(e,i,o,n,p){n=n||100,p?t.scrollTo(e.hide().insertAfter(i).slideDown().offset().top-n):o?t.scrollTo(e.hide().appendTo(i).slideDown().offset().top-n):i.append(e)},t.isVisualEditor=function(){return $("#wp-pt_pb_editor-wrap").hasClass("tmce-active")},t.getContent=function(){return t.isVisualEditor()?tinyMCE.get("pt_pb_editor").getContent():$("#pt_pb_editor").val()},t.setContent=function(e){t.isVisualEditor()&&void 0!==tinyMCE.get("pt_pb_editor")?tinyMCE.get("pt_pb_editor").setContent(e):$("#pt_pb_editor").val(e)},t.createEditor=function(e){e&&0!==e.length&&(e.after(t.cache.editorHtml),setTimeout(function(){"undefined"!=typeof window.switchEditors&&window.switchEditors.go("pt_pb_editor",t.getEditorMode()),window.wpActiveEditor="pt_pb_editor",t.setContent(e.val())},100))},t.removeEditor=function(){if("undefined"!=typeof window.tinyMCE){try{window.tinyMCE.execCommand("mceRemoveEditor",!1,"pt_pb_editor")}catch(t){}"undefined"!=typeof window.tinyMCE.get("pt_pb_editor")&&(window.tinyMCE.remove("#pt_pb_editor"),$("#wp-pt_pb_editor-wrap").remove())}},t.getEditorMode=function(){var t="tinymce";return"html"===getUserSetting("editor")&&(t="html"),t},t.toggleTemplate=function(t){t.preventDefault();var e=$(t.target).val();"page-builder.php"===e?($("#postdivrich, #postimagediv").hide(),$("#pt-pb-layout").show()):($("#pt-pb-layout").hide(),$("#postdivrich, #postimagediv").show())},t.scrollTo=function(e){t.cache.$html.stop().animate({scrollTop:e},600)},t.isMetaSliderActive=function(){return ptPbAppMetaSlider&&ptPbAppMetaSlider.exists&&1==ptPbAppMetaSlider.exists},t.Upload={},t.Upload.AddFile=function(t){var e,i=$(t.target),o=i.parent();return t.preventDefault(),e?void e.open():(e=wp.media({title:i.data("choose"),button:{text:i.data("update"),close:!1}}),e.on("select",function(){var t=e.state().get("selection").first();e.close(),o.find(".pt-pb-upload-field").val(t.attributes.url),o.find(".pt-pb-upload-field-id").val(t.attributes.id),"image"==t.attributes.type&&o.find(".screenshot").empty().hide().append('<img src="'+t.attributes.url+'">').slideDown("fast"),o.find(".pt-pb-upload-button").hide(),o.find(".pt-pb-remove-upload-button").show()}),void e.open())},t.Upload.RemoveFile=function(t){t.find(".pt-pb-upload-field").val(""),t.find(".screenshot").slideUp(200,function(){$(this).empty()}),t.find(".pt-pb-remove-upload-button").hide(),t.find(".pt-pb-upload-button").show()},t.Sections=new t.Collections.Section}(jQuery,ptPbApp),jQuery(document).ready(function($){ptPbApp.cache.editorHtml=ptPbApp.cache.$hiddenEditor.html(),ptPbApp.cache.$hiddenEditor.remove(),ptPbApp.cache.$pageTemplate.on("change",ptPbApp.toggleTemplate).trigger("change"),ptPbApp.cache.$container.sortable({handle:".pt-pb-header",forcePlaceholderSizeType:!0,distance:2,tolerance:"pointer",items:".pt-pb-section",cancel:".pt-pb-settings, .pt-pb-clone, .pt-pb-remove, .pt-pb-section-add, .pt-pb-row-add, .pt-pb-insert-module, .pt-pb-insert-column, .pt-pb-content"}),ptPbApp.cache.$container.on("click",".pt-pb-module-toggle",function(t){t.preventDefault(),$(this).closest(".module-controls").siblings(".content-preview, .slide-content-preview").slideToggle(300,function(){$(this).siblings(".module-controls").toggleClass("close")})}),_.each(ptPbAppSections,function(t){ptPbApp.AddSection(t)}),$(".pt-pb-insert-section").on("click",function(t){t.preventDefault(),ptPbApp.AddSection(null,!0)}),$("#pt_pb_loader").slideUp()});